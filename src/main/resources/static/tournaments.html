<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tournament Viewer</title>
  <link rel="stylesheet" href="/css/tournament.css">
</head>
<body>
  <nav class="site-nav">
    <a href="/tournaments.html" class="active">Tournaments</a>
    <a href="/">Create</a>
  </nav>
  <div class="container">
    <h1>Tournaments</h1>
    <div id="tournament-list" class="tournament-list">
      <p class="loading">Loading tournaments...</p>
    </div>
  </div>
  <script>
    (async function() {
      const listEl = document.getElementById('tournament-list');
      try {
        const res = await fetch('/api/tournaments');
        if (!res.ok) throw new Error('Failed to fetch tournaments');
        const tournaments = await res.json();
        if (tournaments.length === 0) {
          listEl.innerHTML = '<p class="empty">No tournaments found. Create your first tournament!</p>';
          return;
        }
        listEl.innerHTML = '';
        for (const t of tournaments) {
          const card = document.createElement('a');
          card.className = 'tournament-card';
          card.href = '/playback.html?t=' + encodeURIComponent(t.name);
          card.innerHTML =
            '<h2>' + escapeHtml(t.name) + '</h2>' +
            '<div class="stats">' +
            '<span>' + t.playerCount + ' players</span>' +
            '<span>' + t.eventCount + ' games</span>' +
            '</div>';
          listEl.appendChild(card);
        }
      } catch (e) {
        listEl.innerHTML = '<p class="error">Error loading tournaments: ' + escapeHtml(e.message) + '</p>';
      }
    })();

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }
  </script>
</body>
</html>
